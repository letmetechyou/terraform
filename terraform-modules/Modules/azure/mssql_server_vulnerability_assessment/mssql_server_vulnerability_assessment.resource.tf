resource "azurerm_mssql_server_vulnerability_assessment" "mssql_server_vulnerability_assessment" {
  for_each = { for key, value in var.mssql_server_vulnerability_assessment_data : key => value if value.enabled }

  # Required Arguments
  server_security_alert_policy_id = each.value.server_security_alert_policy_id
  storage_container_path          = "${var.storage_account_output[storage_account_name].primary_blob_endpoint}${var.storage_container_output[storage_container_name].name}"


  # Required Blocks 



  # Optional Arguments
  storage_account_access_key = each.value.storage_account_access_key
  storage_container_sas_key  = each.value.storage_container_sas_key


  # Optional Dynamic Blocks
  dynamic "recurring_scans" {

    for_each = each.value.recurring_scans != null ? range(length(each.value.recurring_scans)) : []

    content {
      # Required

      # Optional
      emails                    = each.value.recurring_scans[recurring_scans.key].emails
      email_subscription_admins = each.value.recurring_scans[recurring_scans.key].email_subscription_admins
      enabled                   = each.value.recurring_scans[recurring_scans.key].enabled
    }
  }



  lifecycle {
    prevent_destroy = false
  }
}
